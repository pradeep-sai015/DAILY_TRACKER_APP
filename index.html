<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daily Tracker</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding-left: 20px;
      padding-right: 20px;
      padding-bottom: 20px;
      padding-top: 70px; /* For fixed .top-bar */
      transition: background-color 0.3s, color 0.3s;

      /* === CSS Variables === */
      --body-bg: #f0f8f5;
      --text-color: #333;
      --container-bg: #ffffff;
      --primary-highlight: #9c27b0;
      --input-bg: #e0f7fa;
      --category-btn-bg: #e6ffe6;
      --category-btn-border: #4caf50;
      --category-btn-color: #2e7d32;
      --category-btn-hover-bg: #4caf50;
      --category-btn-hover-color: #fff;
      --summary-header-bg: #f3e5f5;
      --nav-tab-bg: #eee;
      --nav-tab-border: #ccc;
      --nav-tab-text: #555;
      --nav-tab-active-bg: var(--container-bg);
      --nav-tab-active-border: var(--primary-highlight);
      --nav-tab-active-text: var(--primary-highlight);

      /* Profile specific colors */
      --profile-bg: #f7f7f7;
      --profile-text: #333;
      --profile-border: #ddd;
      --profile-edit-btn-bg: #4CAF50;
      --profile-edit-btn-hover-bg: #45a049;
    }

    body.light-mode {
      background-color: var(--body-bg);
      color: var(--text-color);
    }

    body.dark-mode {
      background-color: #121212;
      color: #f5f5f5;
      /* --- Overriding variables for Dark Mode --- */
      --body-bg: #121212;
      --text-color: #f5f5f5;
      --container-bg: #1e1e1e;
      --primary-highlight: #ffc107;
      --input-bg: #333;
      --category-btn-bg: #3f51b5;
      --category-btn-border: #9fa8da;
      --category-btn-color: #e8e4f6;
      --category-btn-hover-bg: #7986cb;
      --category-btn-hover-color: #fff;
      --summary-header-bg: #424242;
      --nav-tab-bg: #333;
      --nav-tab-border: #555;
      --nav-tab-text: #ccc;
      --nav-tab-active-bg: var(--container-bg);
      --nav-tab-active-border: var(--primary-highlight);
      --nav-tab-active-text: var(--primary-highlight);

      /* Profile specific colors for Dark Mode */
      --profile-bg: #282828;
      --profile-text: #f5f5f5;
      --profile-border: #444;
      --profile-edit-btn-bg: #7986cb;
      --profile-edit-btn-hover-bg: #5c6bc0;
    }

    .hidden {
      display: none !important;
    }

    #profileOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center; align-items: center;
        z-index: 2000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    #profileOverlay.visible {
        opacity: 1;
        pointer-events: all;
    }

    .container, form, .suggestions { 
      max-width: 720px;
      margin: 30px auto;
      background: var(--container-bg);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid #e0e0e0;
    }
    
    .date-filter {
      max-width: 720px; margin: 0 auto 20px auto; 
      background: var(--container-bg);
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      border: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .date-filter label {
      margin-bottom: 8px;
      font-weight: 500;
    }
    .date-filter input[type="date"],
    .date-filter input[type="week"],
    .date-filter input[type="month"] {
      width: auto; min-width: 180px; max-width: 240px;  
      padding: 10px; margin: 0; text-align: center;
    }

    .summary { 
      max-width: 100%; margin: 20px 0; 
      background: white; border: 1px solid #e0e0e0;
      border-radius: 16px; padding: 15px; 
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    body.dark-mode .container, body.dark-mode form, body.dark-mode .suggestions,
    body.dark-mode .date-filter { 
        border: 1px solid #444;
        background: var(--container-bg); 
    }
    body.dark-mode .summary {
        background: #2c2c2c; 
        border: 1px solid #555;
    }

    h2 { text-align: center; color: var(--primary-highlight); margin-bottom: 20px; }
    .summary h3 { 
        text-align: center; color: var(--primary-highlight);
        margin-top: 0; margin-bottom: 15px;
    }
    label { font-weight: 500; margin-top: 10px; display: block; }

    input, select, textarea { 
      width: 100%; padding: 12px; margin: 10px 0 20px 0;
      border-radius: 8px; border: 1px solid #ccc;
      background: var(--input-bg); color: var(--text-color);
      font-size: 1rem; box-sizing: border-box;
    }
    body.dark-mode input, body.dark-mode select, body.dark-mode textarea { border: 1px solid #555; }

    button { width: 100%; padding: 12px; background: linear-gradient(45deg, #ffd700, #ffb300); color: #333; border: none; font-weight: bold; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: background 0.3s ease; }
    body.dark-mode button { background: linear-gradient(45deg, #ffc107, #ff8f00); color: #121212; }
    button:hover { background: linear-gradient(45deg, #ffb300, #ffd700); }
    body.dark-mode button:hover { background: linear-gradient(45deg, #ff8f00, #ffc107); }

    #dailySummaryView .summary button[onclick="exportCSV()"] {
      width: auto; padding: 10px 20px;
      display: block; margin: 0 auto 20px auto; 
    }

    .category-button { width: 100%; padding: 15px; margin: 12px 0; font-size: 1.1rem; background-color: var(--category-btn-bg); border: 2px solid var(--category-btn-border); border-radius: 10px; color: var(--category-btn-color); cursor: pointer; transition: 0.3s; }
    .category-button:hover { background-color: var(--category-btn-hover-bg); color: var(--category-btn-hover-color); }

    .summary table { width: auto; min-width: 100%; border-collapse: collapse; }
    .summary th, .summary td { padding: 10px; border: 1px solid #ddd; text-align: left; font-size: 0.9rem; white-space: nowrap; }
    body.dark-mode .summary th, body.dark-mode .summary td { border: 1px solid #555; }
    .summary th { background-color: var(--summary-header-bg); font-size: 0.95rem; position: sticky; top: 0; z-index: 1; }
    
    .completed { text-decoration: line-through; opacity: 0.6; }
    .suggestions { margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--nav-tab-border); }
    .suggestions h4 { margin-bottom: 10px; text-align: left; color: var(--text-color); }
    .suggestions button { margin: 0 6px 6px 0; padding: 6px 14px; font-size: 0.9rem; background: #fff3e0; border: 1px solid #ffb74d; border-radius: 6px; cursor: pointer; width: auto; color: #c66900; }
    body.dark-mode .suggestions button { background: #424242; border-color: #757575; color: #ffcc80; }
    .suggestions button:hover { background: #ffe082; }
    body.dark-mode .suggestions button:hover { background: #616161; }
    .view-toggle { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--nav-tab-border); }
    .view-toggle button { width: auto; padding: 10px 20px; margin: 0 10px; background-color: var(--primary-highlight); color: white; }
    .view-toggle button:hover { opacity: 0.8; background-color: var(--primary-highlight); }
    .top-bar { position: fixed; top: 15px; left: 20px; z-index: 1000; display: flex; gap: 10px; }
    .top-bar button { width: auto; padding: 8px 14px; background: var(--primary-highlight); color: white; font-size: 0.9rem; margin-left: 0; }

    body.personal-theme { --body-bg: #e3f2fd; --container-bg: #ffffff; --primary-highlight: #ffb300; --input-bg: #bbdefb; --category-btn-bg: #fffde7; --category-btn-border: #ffecb3; --category-btn-color: #ff8f00; --category-btn-hover-bg: #ffe082; --category-btn-hover-color: #333; --summary-header-bg: #ffcc80; --nav-tab-active-border: #ffb300; --nav-tab-active-text: #ffb300; --profile-edit-btn-bg: #ffc107; --profile-edit-btn-hover-bg: #ffb300; }
    body.study-theme { --body-bg: #e0f7fa; --container-bg: #ffffff; --primary-highlight: #1976d2; --input-bg: #b3e5fc; --category-btn-bg: #e1f5fe; --category-btn-border: #42a5f5; --category-btn-color: #0d47a1; --category-btn-hover-bg: #90caf9; --category-btn-hover-color: #fff; --summary-header-bg: #90caf9; --nav-tab-active-border: #1976d2; --nav-tab-active-text: #1976d2; --profile-edit-btn-bg: #2196f3; --profile-edit-btn-hover-bg: #1976d2; }
    body.work-theme { --body-bg: #f3e5f5; --container-bg: #ffffff; --primary-highlight: #8e24aa; --input-bg: #e1bee7; --category-btn-bg: #fce4ec; --category-btn-border: #ab47bc; --category-btn-color: #4a148c; --category-btn-hover-bg: #ce93d8; --category-btn-hover-color: #fff; --summary-header-bg: #ce93d8; --nav-tab-active-border: #8e24aa; --nav-tab-active-text: #8e24aa; --profile-edit-btn-bg: #9c27b0; --profile-edit-btn-hover-bg: #8e24aa; }
    .tracker-nav { display: flex; justify-content: center; margin-top: 0; margin-bottom: 20px; background: var(--container-bg); border-top-left-radius: 16px; border-top-right-radius: 16px; overflow: hidden; }
    .tracker-nav .nav-tab { flex: 1; padding: 12px 0; text-align: center; background-color: var(--nav-tab-bg); border: 1px solid var(--nav-tab-border); border-bottom: none; color: var(--nav-tab-text); cursor: pointer; font-weight: 600; transition: background-color 0.3s, color 0.3s, border-color 0.3s; border-radius: 0; width: auto !important; }
    .tracker-nav .nav-tab:first-child { border-top-left-radius: 16px; }
    .tracker-nav .nav-tab:last-child { border-top-right-radius: 16px; }
    .tracker-nav .nav-tab:hover:not(.active) { background-color: var(--nav-tab-border); color: var(--text-color); }
    .tracker-nav .nav-tab.active { background-color: var(--nav-tab-active-bg); border-bottom: 3px solid var(--nav-tab-active-border); color: var(--nav-tab-active-text); cursor: default; }
    
    #step4 > .container {
        border-top-left-radius: 0; border-top-right-radius: 0; border-top: none;
        margin-top: 0;
        overflow-x: auto; 
    }

    .profile-content { background: var(--profile-bg); padding: 30px; border-radius: 16px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4); width: 95%; max-width: 600px; height: 90vh; position: relative; text-align: center; color: var(--profile-text); border: 1px solid var(--profile-border); display: flex; flex-direction: column; justify-content: space-between; overflow-y: auto; }
    .profile-header { position: relative; margin-bottom: 20px; padding-top: 20px; }
    .profile-header h3 { color: var(--primary-highlight); margin-bottom: 20px; text-align: center; }
    .profile-avatar { width: 120px; height: 120px; background-color: var(--primary-highlight); border-radius: 50%; margin: 0 auto 25px auto; display: flex; justify-content: center; align-items: center; font-size: 3rem; font-weight: bold; color: white; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); flex-shrink: 0; text-transform: uppercase; }
    .profile-data-section { flex-grow: 1; text-align: left; margin-bottom: 30px; }
    .profile-data-item { display: flex; align-items: center; justify-content: space-between; margin: 15px 0; padding: 8px 20px; background-color: var(--input-bg); border-radius: 8px; border: 1px solid var(--profile-border); color: var(--text-color); font-size: 1.1rem; }
    .profile-data-item strong { min-width: 100px; display: inline-block; color: var(--primary-highlight); }
    .profile-data-item .edit-icon { background: var(--profile-edit-btn-bg); color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.9rem; margin-left: 10px; transition: background-color 0.2s ease; flex-shrink: 0; width: auto !important; }
    .profile-data-item .edit-icon:hover { background: var(--profile-edit-btn-hover-bg); }
    .profile-actions { display: flex; flex-direction: column; gap: 15px; margin-top: auto; }
    .profile-actions .reset-button { background: #ef5350; color: white; }
    .profile-actions .reset-button:hover { background: #d32f2f; }
    .profile-actions .logout-button { background: #9e9e9e; color: white; }
    .profile-actions .logout-button:hover { background: #757575; }
    .profile-actions .toggle-theme-button { background: #673ab7; color: white; }
    .profile-actions .toggle-theme-button:hover { background: #5e35b1; }
    .close-button { position: absolute; top: 0px; right: 0px; background: var(--primary-highlight); color: white; border-radius: 50%; width: 35px; height: 35px; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.3); transition: background-color 0.2s; padding: 0;}
    .close-button:hover { background-color: var(--nav-tab-active-border); }

    .summary td button { width: auto; padding: 5px 8px; font-size: 0.8rem; margin: 2px; display: inline-block; }

  </style>
</head>
<body class="light-mode">

  <div class="top-bar"> <button onclick="showProfile()">Profile</button> </div>

  <div id="step1" class="container"> </div>
  <div id="step2" class="container hidden"> </div>
  <div id="step3" class="container hidden"> </div>

  <div id="step4" class="hidden">
    <div class="tracker-nav">
      <button class="nav-tab" onclick="goToStep(3)">← Categories</button>
      <button class="nav-tab active" id="dailyTrackerTab" onclick="showTrackerTab('daily')">Daily Tracker</button>
      <button class="nav-tab" id="weeklyTrackerTab" onclick="showTrackerTab('weekly')">Weekly Tracker</button>
      <button class="nav-tab" id="monthlyTrackerTab" onclick="showTrackerTab('monthly')">Monthly Tracker</button>
    </div>

    <div class="container"> <div id="dailyTrackerView">
            <div id="dailyFormView">
                <div class="date-filter"> <label for="viewDate">Select Date:</label> <input type="date" id="viewDate" /> </div>
                <form id="taskForm"> <input type="text" id="taskName" placeholder="e.g. Workout, Study" required /> <input type="time" id="startTime" required /> <input type="time" id="endTime" required /> <select id="taskType" required> <option value="">Select Type</option> <option value="Important">Important</option> <option value="Optional">Optional</option> </select> <input type="date" id="taskDate" required /> <button type="submit">Add Task</button> </form>
                <div class="suggestions"> <h4>Suggestions:</h4> <div id="suggestionButtonsDaily"></div> </div>
                <div class="view-toggle"> <button onclick="showDailySummaryView()">Next ➔ View Tasks</button> </div>
            </div>
            <div id="dailySummaryView" class="hidden">
                <div class="date-filter"> <label for="viewDateSummary">Viewing tasks for:</label> <input type="date" id="viewDateSummary" /> </div>
                <div class="summary"> <h3>Daily Task Summary</h3> <button onclick="exportCSV()">Export to CSV</button> <table> <thead> <tr> <th>Task</th> <th>Time</th> <th>Type</th> <th>Done</th> <th>Actions</th> </tr> </thead> <tbody id="taskTableBody"></tbody> </table> </div>
                <div class="view-toggle"> <button onclick="showDailyFormView()">← Back to Form</button> </div>
            </div>
        </div>
        <div id="weeklyTrackerView" class="hidden">
            <div id="weeklyFormView">
                <div class="date-filter"> <label for="viewWeek">Select Week:</label> <input type="week" id="viewWeek" /> </div>
                <form id="weeklyTaskForm"> <label for="weeklyTaskName">Goal/Task Name:</label> <input type="text" id="weeklyTaskName" placeholder="e.g., Plan weekend meals" required /> <label for="weeklyTaskCategory">Category (optional):</label> <select id="weeklyTaskCategory"> <option value="">Select Category</option> <option value="Personal">Personal</option> <option value="Work">Work</option> <option value="Study">Study</option> <option value="Fitness">Fitness</option> <option value="Finance">Finance</option><option value="Other">Other</option> </select> <label for="weeklyTaskNotes">Notes (optional):</label> <textarea id="weeklyTaskNotes" placeholder="Any extra details..." rows="3"></textarea> <button type="submit">Add Weekly Goal</button> </form>
                <div class="suggestions"> <h4>Suggestions:</h4> <div id="suggestionButtonsWeekly"></div> </div>
                <div class="view-toggle"> <button onclick="showWeeklySummaryView()">Next ➔ View Goals</button> </div>
            </div>
            <div id="weeklySummaryView" class="hidden">
                <div class="date-filter"> <label for="viewWeekSummary">Viewing goals for week:</label> <input type="week" id="viewWeekSummary" /> </div>
                <div class="summary"> <h3>This Week's Goals</h3> <table> <thead> <tr> <th>Goal</th> <th>Category</th> <th>Notes</th> <th>Done</th> <th>Actions</th> </tr> </thead> <tbody id="weeklyTaskTableBody"></tbody> </table> </div>
                <div class="view-toggle"> <button onclick="showWeeklyFormView()">← Back to Form</button> </div>
            </div>
        </div>
        <div id="monthlyTrackerView" class="hidden">
            <div id="monthlyFormView">
                 <div class="date-filter"> <label for="viewMonth">Select Month:</label> <input type="month" id="viewMonth" /> </div>
                <form id="monthlyTaskForm"> <label for="monthlyTaskName">Focus Area/Goal:</label> <input type="text" id="monthlyTaskName" placeholder="e.g., Save $200" required /> <label for="monthlyTaskCategory">Category (optional):</label> <select id="monthlyTaskCategory"> <option value="">Select Category</option> <option value="Personal Growth">Personal Growth</option> <option value="Financial">Financial</option> <option value="Health & Wellness">Health & Wellness</option> <option value="Career">Career</option> <option value="Learning">Learning</option> <option value="Other">Other</option> </select> <label for="monthlyTaskNotes">Key Objectives/Notes:</label> <textarea id="monthlyTaskNotes" placeholder="Break down your goal..." rows="3"></textarea> <button type="submit">Add Monthly Focus</button> </form>
                <div class="suggestions"> <h4>Suggestions:</h4> <div id="suggestionButtonsMonthly"></div> </div>
                <div class="view-toggle"> <button onclick="showMonthlySummaryView()">Next ➔ View Focus</button> </div>
            </div>
            <div id="monthlySummaryView" class="hidden">
                <div class="date-filter"> <label for="viewMonthSummary">Viewing focus for month:</label> <input type="month" id="viewMonthSummary" /> </div>
                <div class="summary"> <h3>This Month's Focus Areas</h3> <table> <thead> <tr> <th>Focus/Goal</th> <th>Category</th> <th>Objectives/Notes</th> <th>Achieved</th> <th>Actions</th> </tr> </thead> <tbody id="monthlyTaskTableBody"></tbody> </table> </div>
                <div class="view-toggle"> <button onclick="showMonthlyFormView()">← Back to Form</button> </div>
            </div>
        </div>
    </div>
  </div>

  <div id="profileOverlay" class="hidden" onclick="handleOverlayClick(event)"> </div>

  <script>
    // === TEMPORARY DEBUGGING AID ===
    // localStorage.clear(); 
    // ==============================

    const body = document.body;
    let dailyFormView, dailySummaryView, viewDateInput, viewDateSummaryInput, taskDateInput, taskForm, taskTableBody;
    let dailyTasks = JSON.parse(localStorage.getItem("customTasks") || "[]");
    let weeklyFormView, weeklySummaryView, weeklyTaskForm, weeklyTaskTableBody, viewWeekInput, viewWeekSummaryInput;
    let weeklyTasks = JSON.parse(localStorage.getItem("weeklyCustomTasks") || "[]");
    let monthlyFormView, monthlySummaryView, monthlyTaskForm, monthlyTaskTableBody, viewMonthInput, viewMonthSummaryInput;
    let monthlyTasks = JSON.parse(localStorage.getItem("monthlyCustomTasks") || "[]");

    function assignGlobalElements() {
        dailyFormView = document.getElementById('dailyFormView'); dailySummaryView = document.getElementById('dailySummaryView'); viewDateInput = document.getElementById("viewDate"); viewDateSummaryInput = document.getElementById("viewDateSummary"); taskDateInput = document.getElementById("taskDate"); taskForm = document.getElementById("taskForm"); taskTableBody = document.getElementById("taskTableBody");
        weeklyFormView = document.getElementById('weeklyFormView'); weeklySummaryView = document.getElementById('weeklySummaryView'); weeklyTaskForm = document.getElementById("weeklyTaskForm"); weeklyTaskTableBody = document.getElementById("weeklyTaskTableBody"); viewWeekInput = document.getElementById("viewWeek"); viewWeekSummaryInput = document.getElementById("viewWeekSummary");
        monthlyFormView = document.getElementById('monthlyFormView'); monthlySummaryView = document.getElementById('monthlySummaryView'); monthlyTaskForm = document.getElementById("monthlyTaskForm"); monthlyTaskTableBody = document.getElementById("monthlyTaskTableBody"); viewMonthInput = document.getElementById("viewMonth"); viewMonthSummaryInput = document.getElementById("viewMonthSummary");
        
        if (viewDateInput) viewDateInput.addEventListener("change", () => { if(taskDateInput) taskDateInput.value = viewDateInput.value; if(viewDateSummaryInput) viewDateSummaryInput.value = viewDateInput.value; renderSummary(); });
        if (viewWeekInput) viewWeekInput.addEventListener("change", () => { if(viewWeekSummaryInput) viewWeekSummaryInput.value = viewWeekInput.value; renderWeeklySummary(); });
        if (viewMonthInput) viewMonthInput.addEventListener("change", () => { if(viewMonthSummaryInput) viewMonthSummaryInput.value = viewMonthInput.value; renderMonthlySummary(); });
        if (viewDateSummaryInput) viewDateSummaryInput.addEventListener("change", () => { if(viewDateInput) viewDateInput.value = viewDateSummaryInput.value; if(taskDateInput) taskDateInput.value = viewDateSummaryInput.value; renderSummary(); });
        if (viewWeekSummaryInput) viewWeekSummaryInput.addEventListener("change", () => { if(viewWeekInput) viewWeekInput.value = viewWeekSummaryInput.value; renderWeeklySummary(); });
        if (viewMonthSummaryInput) viewMonthSummaryInput.addEventListener("change", () => { if(viewMonthInput) viewMonthInput.value = viewMonthSummaryInput.value; renderMonthlySummary(); });

        if (taskForm) taskForm.addEventListener("submit", e => { e.preventDefault(); const name = document.getElementById("taskName").value.trim(); const start = document.getElementById("startTime").value; const end = document.getElementById("endTime").value; const type = document.getElementById("taskType").value; const date = document.getElementById("taskDate").value; if (!name || !start || !end || !type || !date) return alert("Please fill all daily task fields"); dailyTasks.push({ name, start, end, type, date, recurrence: 'daily', completed: false, id: Date.now() }); localStorage.setItem("customTasks", JSON.stringify(dailyTasks)); taskForm.reset(); if(taskDateInput && viewDateInput) taskDateInput.value = viewDateInput.value; renderSummary(); });
        if (weeklyTaskForm) weeklyTaskForm.addEventListener("submit", e => { e.preventDefault(); const name = document.getElementById("weeklyTaskName").value.trim(); const category = document.getElementById("weeklyTaskCategory").value; const notes = document.getElementById("weeklyTaskNotes").value.trim(); const week = viewWeekInput.value; if (!name || !week) return alert("Weekly goal name and week are required."); weeklyTasks.push({ id: Date.now(), name, category, notes, week, completed: false }); localStorage.setItem("weeklyCustomTasks", JSON.stringify(weeklyTasks)); weeklyTaskForm.reset(); if(document.getElementById("weeklyTaskCategory")) document.getElementById("weeklyTaskCategory").value = ""; renderWeeklySummary(); });
        if (monthlyTaskForm) monthlyTaskForm.addEventListener("submit", e => { e.preventDefault(); const name = document.getElementById("monthlyTaskName").value.trim(); const category = document.getElementById("monthlyTaskCategory").value; const notes = document.getElementById("monthlyTaskNotes").value.trim(); const month = viewMonthInput.value; if (!name || !month) return alert("Monthly focus/goal name and month are required."); monthlyTasks.push({ id: Date.now(), name, category, notes, month, completed: false }); localStorage.setItem("monthlyCustomTasks", JSON.stringify(monthlyTasks)); monthlyTaskForm.reset(); if(document.getElementById("monthlyTaskCategory")) document.getElementById("monthlyTaskCategory").value = ""; renderMonthlySummary(); });
        console.log("Global elements assigned and listeners attached.");
    }

    function toggleDarkMode() { console.log("toggleDarkMode called"); body.classList.toggle("dark-mode"); body.classList.toggle("light-mode"); localStorage.setItem("darkMode", body.classList.contains("dark-mode")); }
    
    // UPDATED applySavedTheme to restore previous navigation logic
    function applySavedTheme() {
      console.log("--- applySavedTheme called ---");
      const isDarkMode = localStorage.getItem("darkMode") === "true";
      if (isDarkMode) {
        body.classList.add("dark-mode");
        body.classList.remove("light-mode");
      } else {
         body.classList.add("light-mode");
         body.classList.remove("dark-mode");
      }
      
      const savedUserName = localStorage.getItem("userName")?.trim();
      const savedUserMobile = localStorage.getItem("userMobile")?.trim();
      const savedUserAge = localStorage.getItem("userAge")?.trim();
      const savedUserWeight = localStorage.getItem("userWeight")?.trim();
      const savedUserHeight = localStorage.getItem("userHeight")?.trim();
      const savedUserCategory = localStorage.getItem("userCategory")?.trim();

      console.log("Saved Data for navigation: Name=", savedUserName, "Mobile=", savedUserMobile, "Age=", savedUserAge, "Category=", savedUserCategory);

      const hasLogin = !!savedUserName && !!savedUserMobile;
      const hasPersonalDetails = hasLogin && !!savedUserAge && !!savedUserWeight && !!savedUserHeight;
      const hasCategory = hasPersonalDetails && !!savedUserCategory;

      if (hasCategory) {
          console.log("All details found. Navigating to Step 4.");
          goToStep(4);
      } else if (hasPersonalDetails) {
          console.log("Personal details found. Navigating to Step 3 (Category selection).");
          goToStep(3);
      } else if (hasLogin) {
          console.log("Login details found. Navigating to Step 2 (Personal details).");
          goToStep(2);
      } else {
          console.log("No saved progress found. Navigating to Step 1.");
          goToStep(1);
      }
      console.log("--- applySavedTheme finished ---");
    }

    function saveLoginDetailsAndGoToStep2() { console.log("saveLoginDetailsAndGoToStep2 called"); const nameInput = document.getElementById("name"); const mobileInput = document.getElementById("mobile"); if (!nameInput || !mobileInput) { console.error("Name or Mobile input field not found in saveLoginDetailsAndGoToStep2!"); alert("A problem occurred with the form. Please refresh and try again."); return; } const name = nameInput.value.trim(); const mobile = mobileInput.value.trim(); if (!name || !mobile) { alert("Please enter your name and mobile number."); return; } localStorage.setItem("userName", name); localStorage.setItem("userMobile", mobile); console.log("Login details saved (Name:", name, ", Mobile:", mobile, "), calling goToStep(2)"); goToStep(2); }
    function goToStep(step) { console.log(`goToStep(${step}) called`); const categoryThemeClasses = ["personal-theme", "study-theme", "work-theme"]; const profileButton = document.querySelector('.top-bar button[onclick="showProfile()"]'); if (profileButton) profileButton.style.display = 'none'; for (let i = 1; i <= 4; i++) { const stepElement = document.getElementById(`step${i}`); if (stepElement) { stepElement.classList.add('hidden'); } else { console.error(`Element with ID step${i} not found in goToStep for hiding.`); } } const targetStepElement = document.getElementById(`step${step}`); if (targetStepElement) { targetStepElement.classList.remove('hidden'); console.log(`Successfully displayed step${step}`); } else { console.error(`Target element with ID step${step} not found in goToStep for showing.`); const step1Fallback = document.getElementById('step1'); if(step1Fallback) step1Fallback.classList.remove('hidden'); return;  } if (step === 4) { const savedCategory = localStorage.getItem("userCategory")?.trim(); if (savedCategory) body.classList.add(`${savedCategory.toLowerCase()}-theme`); setDefaultDateForDaily(); setDefaultWeek(); setDefaultMonth(); const activeNavTab = document.querySelector('.tracker-nav .nav-tab.active'); let initialTab = 'daily'; if (activeNavTab && activeNavTab.id === 'weeklyTrackerTab') initialTab = 'weekly'; else if (activeNavTab && activeNavTab.id === 'monthlyTrackerTab') initialTab = 'monthly'; showTrackerTab(initialTab); } else { body.classList.remove(...categoryThemeClasses); } if (step >= 2 && profileButton) { profileButton.style.display = 'block'; } }
    function showTrackerTab(tabName) { console.log(`showTrackerTab called for: ${tabName}`); const views = ['dailyTrackerView', 'weeklyTrackerView', 'monthlyTrackerView']; const tabs = ['dailyTrackerTab', 'weeklyTrackerTab', 'monthlyTrackerTab']; views.forEach(viewId => { const el = document.getElementById(viewId); if(el) el.classList.add('hidden'); else console.warn(`View element ${viewId} not found in showTrackerTab`); }); tabs.forEach(tabId => { const el = document.getElementById(tabId); if(el) el.classList.remove('active'); else console.warn(`Tab element ${tabId} not found in showTrackerTab`); }); let activeViewId, activeTabId; switch(tabName) { case 'daily': activeViewId = 'dailyTrackerView'; activeTabId = 'dailyTrackerTab'; if(document.getElementById(activeViewId)) document.getElementById(activeViewId).classList.remove('hidden'); if(document.getElementById(activeTabId)) document.getElementById(activeTabId).classList.add('active'); if(dailyFormView && dailySummaryView) showDailyFormView(); else console.warn("Daily form/summary views not ready in showTrackerTab for daily"); renderSummary(); updateSuggestions('daily'); break; case 'weekly': activeViewId = 'weeklyTrackerView'; activeTabId = 'weeklyTrackerTab'; if(document.getElementById(activeViewId)) document.getElementById(activeViewId).classList.remove('hidden'); if(document.getElementById(activeTabId)) document.getElementById(activeTabId).classList.add('active'); if(weeklyFormView && weeklySummaryView) showWeeklyFormView(); else console.warn("Weekly form/summary views not ready in showTrackerTab for weekly"); renderWeeklySummary(); updateSuggestions('weekly'); break; case 'monthly': activeViewId = 'monthlyTrackerView'; activeTabId = 'monthlyTrackerTab'; if(document.getElementById(activeViewId)) document.getElementById(activeViewId).classList.remove('hidden'); if(document.getElementById(activeTabId)) document.getElementById(activeTabId).classList.add('active'); if(monthlyFormView && monthlySummaryView) showMonthlyFormView(); else console.warn("Monthly form/summary views not ready in showTrackerTab for monthly"); renderMonthlySummary(); updateSuggestions('monthly'); break; default: console.warn(`Unknown tabName: ${tabName} in showTrackerTab. Defaulting to daily.`); showTrackerTab('daily'); return; } console.log(`Active tab set to ${activeTabId}, view to ${activeViewId}`); }
    function toggleHeightUnit() { const elCm = document.getElementById("cmHeightBlock"); const elFt = document.getElementById("ftHeightBlock"); const unit = document.getElementById("heightUnit")?.value; if(elCm) elCm.style.display = unit === "cm" ? "block" : "none"; if(elFt) elFt.style.display = unit === "ft" ? "flex" : "none"; }
    function submitDetails() { const weight = document.getElementById("weight")?.value; const age = document.getElementById("age")?.value; const unit = document.getElementById("heightUnit")?.value; let height = ""; if (unit === "cm") { height = document.getElementById("heightCm")?.value; } else { const ft = document.getElementById("heightFt")?.value; const inch = document.getElementById("heightIn")?.value; if (!ft || inch === "") { return alert("Please select height in ft/in"); } height = `${ft}'${inch}"`; } if (!weight || !age || !height ) { return alert("Please fill all personal details");} localStorage.setItem("userWeight", weight); localStorage.setItem("userHeight", height); localStorage.setItem("userAge", age); goToStep(3); }
    function selectCategory(type) { localStorage.setItem("userCategory", type); goToStep(4); }
    const categorySuggestions = { Personal: { daily: ['Exercise (30 min)', 'Meditate (10 min)', 'Walk (15 min)', 'Read (1 chapter)', 'Journal (5 min)', 'Hydrate (8 glasses)'], weekly: ['Meal Prep for 3 days', 'Deep Clean Bathroom', 'Call Family/Friend', 'Review Weekly Budget', 'Plan Weekend Activities', 'Learn New Recipe'], monthly: ['Review Monthly Goals', 'Schedule Doctor/Dentist', 'Car Maintenance Check', 'Dedicate Day to Hobby', 'Plan a Social Outing', 'Volunteer (2 hours)'] }, Study: { daily: ['Revise Lecture Notes', 'Solve 10 Problems', 'Read Textbook (1 section)', 'Attend Online Lecture', 'Quick Quiz on Topic', 'Summarize Learnings'], weekly: ['Review Week\'s Material', 'Prepare for Next Week Topics', 'Complete Practice Test', 'Research for Assignment', 'Group Study Session (2hr)', 'Outline Essay/Project'], monthly: ['Complete Monthly Assignment', 'Meet Study Group for Review', 'Assess Course Progress', 'In-depth Study of Weak Area', 'Explore Advanced Topic', 'Plan Next Month Study Schedule'] }, Work: { daily: ['Check & Reply Emails', 'Attend Team Standup', 'Focus Block (90 min)', 'Update Task Board', 'Quick Break (5 min every hr)', 'Plan Next Day Tasks'], weekly: ['Submit Weekly Report', 'Team Sync Meeting', 'Plan Next Week Tasks', 'Review Performance Metrics', 'Client Follow-up Calls', 'Professional Development (1hr)'], monthly: ['Monthly Performance Review', 'Strategic Planning Session', 'Update Portfolio/Resume', 'Networking Event/Call', 'Expense Report Submission', 'Long-term Project Milestone'] } };
    function updateSuggestions(recurrenceType) { console.log(`updateSuggestions called for: ${recurrenceType}`); const savedCategory = localStorage.getItem("userCategory")?.trim() || 'Personal'; let suggestionContainerId; if (recurrenceType === 'daily') suggestionContainerId = 'suggestionButtonsDaily'; else if (recurrenceType === 'weekly') suggestionContainerId = 'suggestionButtonsWeekly'; else if (recurrenceType === 'monthly') suggestionContainerId = 'suggestionButtonsMonthly'; else { console.warn(`Invalid recurrenceType for suggestions: ${recurrenceType}`); return; } const suggestionContainer = document.getElementById(suggestionContainerId); if (!suggestionContainer) { console.error(`Suggestion container ${suggestionContainerId} not found.`); return; } suggestionContainer.innerHTML = ''; let suggestionsToShow = (categorySuggestions[savedCategory] && categorySuggestions[savedCategory][recurrenceType]) ? categorySuggestions[savedCategory][recurrenceType] : (categorySuggestions.Personal[recurrenceType] || []); suggestionsToShow.forEach(suggestion => { const button = document.createElement('button'); button.textContent = suggestion; button.setAttribute('onclick', `fillSuggested('${suggestion.replace(/'/g, "\\'")}', '${recurrenceType}')`); suggestionContainer.appendChild(button); }); console.log(`Suggestions updated for ${recurrenceType} in ${suggestionContainerId} with ${suggestionsToShow.length} items for category ${savedCategory}.`); }
    function fillSuggested(name, recurrenceType) { console.log(`fillSuggested: Name='${name}', Recurrence='${recurrenceType}'`); let inputId; if (recurrenceType === 'daily') inputId = 'taskName'; else if (recurrenceType === 'weekly') inputId = 'weeklyTaskName'; else if (recurrenceType === 'monthly') inputId = 'monthlyTaskName'; else { console.warn(`Invalid recurrenceType for fillSuggested: ${recurrenceType}`); return; } const taskInput = document.getElementById(inputId); if (taskInput) { taskInput.value = name; taskInput.focus(); console.log(`Filled ${inputId} with '${name}'`); } else { console.error(`Task input ${inputId} not found in fillSuggested.`); } }
    function showDailySummaryView() { if(dailyFormView) dailyFormView.classList.add("hidden"); if(dailySummaryView) dailySummaryView.classList.remove("hidden"); if(viewDateSummaryInput && viewDateInput) viewDateSummaryInput.value = viewDateInput.value; renderSummary(); }
    function showDailyFormView() { if(dailySummaryView) dailySummaryView.classList.add("hidden"); if(dailyFormView) dailyFormView.classList.remove("hidden"); }
    function setDefaultDateForDaily() { const today = new Date().toISOString().split("T")[0]; if(viewDateInput) viewDateInput.value = today; if(taskDateInput) taskDateInput.value = today; if(viewDateSummaryInput) viewDateSummaryInput.value = today; }
    function renderSummary() { if (!taskTableBody || !viewDateInput) { console.warn("renderSummary: Missing taskTableBody or viewDateInput"); return; } const selectedDate = viewDateInput.value; console.log(`renderSummary called for date: ${selectedDate}`); taskTableBody.innerHTML = ""; const filteredTasks = dailyTasks.filter(task => task.date === selectedDate && task.recurrence === 'daily'); console.log(`Filtered daily tasks for ${selectedDate}: ${filteredTasks.length} found.`); if (filteredTasks.length === 0 && selectedDate) { const row = taskTableBody.insertRow(); const cell = row.insertCell(); cell.colSpan = 5; cell.textContent = "No tasks for this day."; cell.style.textAlign = "center"; return; } filteredTasks.forEach(task => { const row = taskTableBody.insertRow(); if (task.completed) row.classList.add("completed"); row.innerHTML = `<td>${task.name}</td> <td>${task.start} - ${task.end}</td> <td>${task.type}</td> <td><input type="checkbox" ${task.completed ? "checked" : ""} onchange="toggleDailyDone(${task.id})" /></td> <td><button onclick="editDailyTask(${task.id})">Edit</button><button onclick="deleteDailyTask(${task.id})">Delete</button></td>`; });}
    function toggleDailyDone(taskId) { const task = dailyTasks.find(t=>t.id===taskId); if(task)task.completed=!task.completed; localStorage.setItem("customTasks",JSON.stringify(dailyTasks)); renderSummary(); }
    function deleteDailyTask(taskId) { if(confirm("Delete this task?")){ dailyTasks=dailyTasks.filter(t=>t.id!==taskId); localStorage.setItem("customTasks",JSON.stringify(dailyTasks)); renderSummary(); }}
    function editDailyTask(taskId) { const task = dailyTasks.find(t => t.id === taskId); if (!task) return; const newName = prompt("Edit Task Name", task.name); const newStart = prompt("Edit Start Time", task.start); const newEnd = prompt("Edit End Time", task.end); const newType = prompt("Edit Type", task.type); if (newName !== null && newStart !== null && newEnd !== null && newType !== null && newName.trim() && newStart.trim() && newEnd.trim() && newType.trim() ) { task.name = newName; task.start = newStart; task.end = newEnd; task.type = newType; localStorage.setItem("customTasks", JSON.stringify(dailyTasks)); renderSummary(); } else if (newName !== null || newStart !== null || newEnd !== null || newType !== null) { alert("All fields must be filled to edit."); }}
    function exportCSV() { if (!viewDateInput) return; const selectedDate = viewDateInput.value; const data = dailyTasks.filter(task => task.date === selectedDate && task.recurrence === 'daily'); if (!data.length) return alert("No tasks to export."); let csv = "Task,Start Time,End Time,Type,Completed,Recurrence\n"; data.forEach(task => csv += `${task.name},${task.start},${task.end},${task.type},${task.completed},${task.recurrence}\n`); const blob = new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const link=document.createElement("a"); link.href=url; link.download=`DailyTasks_${selectedDate}.csv`; document.body.appendChild(link); link.click(); document.body.removeChild(link); }
    function showWeeklySummaryView() { if(weeklyFormView) weeklyFormView.classList.add("hidden"); if(weeklySummaryView) weeklySummaryView.classList.remove("hidden"); if(viewWeekSummaryInput && viewWeekInput) viewWeekSummaryInput.value = viewWeekInput.value; renderWeeklySummary(); }
    function showWeeklyFormView() { if(weeklySummaryView) weeklySummaryView.classList.add("hidden"); if(weeklyFormView) weeklyFormView.classList.remove("hidden"); }
    function setDefaultWeek() { if (viewWeekInput) { const now = new Date(); const year = now.getFullYear(); const firstDayOfYear = new Date(year, 0, 1); const pastDaysOfYear = (now - firstDayOfYear) / 86400000; const weekNumber = Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7); viewWeekInput.value = `${year}-W${String(weekNumber).padStart(2, '0')}`; if(viewWeekSummaryInput) viewWeekSummaryInput.value = viewWeekInput.value; } }
    function renderWeeklySummary() { if (!weeklyTaskTableBody || !viewWeekInput) { console.warn("renderWeeklySummary: Missing elements"); return; } const selectedWeek = viewWeekInput.value; console.log(`renderWeeklySummary called for week: ${selectedWeek}`); weeklyTaskTableBody.innerHTML = ""; const filteredTasks = weeklyTasks.filter(task => task.week === selectedWeek); console.log(`Filtered weekly tasks for ${selectedWeek}: ${filteredTasks.length} found.`); if (filteredTasks.length === 0 && selectedWeek) { const row = weeklyTaskTableBody.insertRow(); const cell = row.insertCell(); cell.colSpan = 5; cell.textContent = "No goals for this week."; cell.style.textAlign = "center"; return; } filteredTasks.forEach(task => { const row = weeklyTaskTableBody.insertRow(); row.className = task.completed ? "completed" : ""; row.innerHTML = `<td>${task.name}</td> <td>${task.category || 'N/A'}</td> <td>${task.notes || 'N/A'}</td> <td><input type="checkbox" ${task.completed ? "checked" : ""} onchange="toggleWeeklyTaskDone(${task.id})"></td> <td><button onclick="editWeeklyTask(${task.id})">Edit</button><button onclick="deleteWeeklyTask(${task.id})">Delete</button></td>`; }); }
    function toggleWeeklyTaskDone(taskId) { const task=weeklyTasks.find(t=>t.id===taskId); if(task)task.completed=!task.completed; localStorage.setItem("weeklyCustomTasks",JSON.stringify(weeklyTasks)); renderWeeklySummary(); }
    function deleteWeeklyTask(taskId) { if(confirm("Delete this weekly goal?")){ weeklyTasks=weeklyTasks.filter(t=>t.id!==taskId); localStorage.setItem("weeklyCustomTasks",JSON.stringify(weeklyTasks)); renderWeeklySummary(); }}
    function editWeeklyTask(taskId) { const task = weeklyTasks.find(t => t.id === taskId); if (!task) return; const newName = prompt("Edit Goal Name:", task.name); if (newName === null) return; const newCategory = prompt("Edit Category:", task.category); const newNotes = prompt("Edit Notes:", task.notes); if (newName.trim()) task.name = newName.trim(); if (newCategory !== null) task.category = newCategory.trim(); if (newNotes !== null) task.notes = newNotes.trim(); localStorage.setItem("weeklyCustomTasks", JSON.stringify(weeklyTasks)); renderWeeklySummary(); }
    function showMonthlySummaryView() { if(monthlyFormView) monthlyFormView.classList.add("hidden"); if(monthlySummaryView) monthlySummaryView.classList.remove("hidden"); if(viewMonthSummaryInput && viewMonthInput) viewMonthSummaryInput.value = viewMonthInput.value; renderMonthlySummary(); }
    function showMonthlyFormView() { if(monthlySummaryView) monthlySummaryView.classList.add("hidden"); if(monthlyFormView) monthlyFormView.classList.remove("hidden"); }
    function setDefaultMonth() { if (viewMonthInput) { const now = new Date(); const year = now.getFullYear(); const month = String(now.getMonth() + 1).padStart(2, '0'); viewMonthInput.value = `${year}-${month}`; if(viewMonthSummaryInput) viewMonthSummaryInput.value = viewMonthInput.value;} }
    function renderMonthlySummary() { if (!monthlyTaskTableBody || !viewMonthInput) { console.warn("renderMonthlySummary: Missing elements"); return; } const selectedMonth = viewMonthInput.value; console.log(`renderMonthlySummary called for month: ${selectedMonth}`); monthlyTaskTableBody.innerHTML = ""; const filteredTasks = monthlyTasks.filter(task => task.month === selectedMonth); console.log(`Filtered monthly tasks for ${selectedMonth}: ${filteredTasks.length} found.`); if (filteredTasks.length === 0 && selectedMonth) { const row = monthlyTaskTableBody.insertRow(); const cell = row.insertCell(); cell.colSpan = 5; cell.textContent = "No focus areas for this month."; cell.style.textAlign = "center"; return; } filteredTasks.forEach(task => { const row = monthlyTaskTableBody.insertRow(); row.className = task.completed ? "completed" : ""; row.innerHTML = `<td>${task.name}</td> <td>${task.category || 'N/A'}</td> <td>${task.notes || 'N/A'}</td> <td><input type="checkbox" ${task.completed ? "checked" : ""} onchange="toggleMonthlyTaskDone(${task.id})"></td> <td><button onclick="editMonthlyTask(${task.id})">Edit</button><button onclick="deleteMonthlyTask(${task.id})">Delete</button></td>`; }); }
    function toggleMonthlyTaskDone(taskId) { const task=monthlyTasks.find(t=>t.id===taskId); if(task)task.completed=!task.completed; localStorage.setItem("monthlyCustomTasks",JSON.stringify(monthlyTasks)); renderMonthlySummary(); }
    function deleteMonthlyTask(taskId) { if(confirm("Delete monthly focus?")){ monthlyTasks=monthlyTasks.filter(t=>t.id!==taskId); localStorage.setItem("monthlyCustomTasks",JSON.stringify(monthlyTasks)); renderMonthlySummary(); }}
    function editMonthlyTask(taskId) { const task = monthlyTasks.find(t => t.id === taskId); if (!task) return; const newName = prompt("Edit Focus/Goal:", task.name); if (newName === null) return; const newCategory = prompt("Edit Category:", task.category); const newNotes = prompt("Edit Objectives/Notes:", task.notes); if (newName.trim()) task.name = newName.trim(); if (newCategory !== null) task.category = newCategory.trim(); if (newNotes !== null) task.notes = newNotes.trim(); localStorage.setItem("monthlyCustomTasks", JSON.stringify(monthlyTasks)); renderMonthlySummary(); }

    // --- Profile Management (Corrected showProfile/hideProfile) ---
    function showProfile() { console.log("showProfile called"); const profileOverlay = document.getElementById("profileOverlay"); if(profileOverlay) { profileOverlay.classList.remove("hidden"); profileOverlay.classList.add("visible"); console.log("Profile overlay: removed .hidden, added .visible."); } else { console.error("profileOverlay element not found in showProfile!"); return; } const uN=localStorage.getItem("userName"); const pN=document.getElementById("profileName"); if(pN)pN.textContent=uN||"N/A"; else console.warn("profileName element not found"); const pM=document.getElementById("profileMobile"); if(pM)pM.textContent=localStorage.getItem("userMobile")||"N/A"; else console.warn("profileMobile element not found"); const pA=document.getElementById("profileAge"); if(pA)pA.textContent=localStorage.getItem("userAge")||"N/A"; else console.warn("profileAge element not found"); const pW=document.getElementById("profileWeight"); if(pW)pW.textContent=localStorage.getItem("userWeight")||"N/A"; else console.warn("profileWeight element not found"); const pH=document.getElementById("profileHeight"); if(pH)pH.textContent=localStorage.getItem("userHeight")||"N/A"; else console.warn("profileHeight element not found"); const pAI=document.getElementById("profileAvatarInitial"); if(pAI)pAI.textContent=uN?uN.charAt(0).toUpperCase():'?'; else console.warn("profileAvatarInitial element not found"); const tdy=new Date().toISOString().split("T")[0]; const tskDone=dailyTasks.filter(t=>t.date===tdy&&t.completed&&t.recurrence==='daily').length; const tDC=document.getElementById("tasksDoneCount"); if(tDC)tDC.textContent=tskDone; else console.warn("tasksDoneCount element not found"); }
    function hideProfile() { console.log("hideProfile called"); const profileOverlay = document.getElementById("profileOverlay"); if(profileOverlay) { profileOverlay.classList.remove("visible"); profileOverlay.classList.add("hidden"); console.log("Profile overlay: removed .visible, added .hidden."); } else { console.error("profileOverlay element not found in hideProfile!"); } }
    function handleOverlayClick(event) { console.log("handleOverlayClick called"); const profileOverlay = document.getElementById("profileOverlay"); if (event.target === profileOverlay) { hideProfile(); } }
    function editProfile(field) { console.log(`editProfile called for field: ${field}`); let nV; switch(field){ case'name': nV=prompt("Edit Name:",localStorage.getItem("userName")||""); if(nV!==null&&nV.trim()!==''){localStorage.setItem("userName",nV.trim()); const pN=document.getElementById("profileName"); if(pN)pN.textContent=nV.trim(); const pAI=document.getElementById("profileAvatarInitial"); if(pAI)pAI.textContent=nV.trim().charAt(0).toUpperCase();} else if(nV!==null)alert("Name cannot be empty."); break; case'mobile': nV=prompt("Edit Mobile:",localStorage.getItem("userMobile")||""); if(nV!==null&&nV.trim()!==''){localStorage.setItem("userMobile",nV.trim()); const pM=document.getElementById("profileMobile"); if(pM)pM.textContent=nV.trim();} else if(nV!==null)alert("Mobile cannot be empty."); break; default:alert(`To edit ${field}, go to "Personal Details".`);} if(field==='name'||field==='mobile')showProfile();}
    function resetAllData() { console.log("resetAllData called"); if(confirm("Reset ALL data? This cannot be undone.")){localStorage.clear(); dailyTasks=[]; weeklyTasks=[]; monthlyTasks=[]; alert("All data reset!"); location.reload();}}
    function logout() { console.log("logout called"); if(confirm("Logout? This clears Name and Mobile.")){localStorage.removeItem("userName");localStorage.removeItem("userMobile");localStorage.removeItem("userCategory"); alert("Logged out."); location.reload();}}

    function populateSelect(id, start, end, suffix = '') { const select = document.getElementById(id); if (!select) {console.warn(`Select element #${id} not found for populateSelect.`); return;} while (select.options.length > 1) select.remove(1); for (let i = start; i <= end; i++) { const opt = document.createElement('option'); opt.value = i; opt.textContent = i + suffix; select.appendChild(opt); } }
    document.addEventListener("DOMContentLoaded", () => {
      console.log("DOMContentLoaded event fired.");
      const step1Div = document.getElementById('step1'); if (step1Div) { step1Div.innerHTML = `<h2>Welcome to Daily Tracker</h2> <input type="text" id="name" placeholder="Enter your name" required /> <input type="tel" id="mobile" placeholder="Enter your mobile number" required /> <button onclick="saveLoginDetailsAndGoToStep2()">Continue</button>`; console.log("Step 1 HTML injected."); } else { console.error("div#step1 not found for HTML injection."); }
      const step2Div = document.getElementById('step2'); if (step2Div) { step2Div.innerHTML = `<h2>Personal Details</h2> <label for="weight">Weight</label> <select id="weight"><option value="">Select Weight (kg)</option></select> <label for="heightUnit">Height Unit</label> <select id="heightUnit" onchange="toggleHeightUnit()"><option value="cm">Centimeters</option><option value="ft">Feet & Inches</option></select> <div id="cmHeightBlock"> <label for="heightCm">Height (cm)</label> <select id="heightCm"><option value="">Select Height (cm)</option></select> </div> <div id="ftHeightBlock" style="display:none; display:flex; gap:10px;"> <div style="flex: 1;"> <label for="heightFt">Feet</label> <select id="heightFt"><option value="">Feet</option></select> </div> <div style="flex: 1;"> <label for="heightIn">Inches</label> <select id="heightIn"><option value="">Inches</option></select> </div> </div> <label for="age">Age</label> <select id="age"><option value="">Select Age</option></select> <button onclick="submitDetails()">Continue</button>`; console.log("Step 2 HTML injected."); } else { console.error("div#step2 not found for HTML injection."); }
      const step3Div = document.getElementById('step3'); if (step3Div) { step3Div.innerHTML = `<h2>Select Your Tracker Type</h2> <button class="category-button" onclick="selectCategory('Personal')">Personal</button> <button class="category-button" onclick="selectCategory('Study')">Study</button> <button class="category-button" onclick="selectCategory('Work')">Work</button>`; console.log("Step 3 HTML injected."); } else { console.error("div#step3 not found for HTML injection."); }
      const profileOverlayDiv = document.getElementById('profileOverlay'); if (profileOverlayDiv) { profileOverlayDiv.innerHTML = `<div class="profile-content"> <div class="profile-header"> <span class="close-button" onclick="hideProfile()">&times;</span> <div class="profile-avatar" id="profileAvatarInitial">?</div> <h3>Your Profile</h3> </div> <div class="profile-data-section"> <div class="profile-data-item"> <strong>Name:</strong> <span id="profileName"></span> <button class="edit-icon" onclick="editProfile('name')">Edit</button> </div> <div class="profile-data-item"> <strong>Mobile:</strong> <span id="profileMobile"></span> <button class="edit-icon" onclick="editProfile('mobile')">Edit</button> </div> <div class="profile-data-item"> <strong>Age:</strong> <span id="profileAge"></span> <button class="edit-icon" onclick="editProfile('age')">Edit</button> </div> <div class="profile-data-item"> <strong>Weight:</strong> <span id="profileWeight"></span> <button class="edit-icon" onclick="editProfile('weight')">Edit</button> </div> <div class="profile-data-item"> <strong>Height:</strong> <span id="profileHeight"></span> <button class="edit-icon" onclick="editProfile('height')">Edit</button> </div> <div class="profile-data-item"> <strong>Tasks Done Today:</strong> <span id="tasksDoneCount">0</span> </div> </div> <div class="profile-actions"> <button class="toggle-theme-button" onclick="toggleDarkMode()">Toggle Dark/Light Mode</button> <button class="reset-button" onclick="resetAllData()">Reset All Data</button> <button class="logout-button" onclick="logout()">Logout</button> </div> </div>`; console.log("Profile Overlay HTML injected."); } else { console.error("div#profileOverlay not found for HTML injection."); }
      assignGlobalElements();
      applySavedTheme(); 
      populateSelect('weight', 40, 150, ' kg'); populateSelect('age', 3, 100); populateSelect('heightCm', 120, 200, ' cm'); populateSelect('heightFt', 4, 6); populateSelect('heightIn', 0, 11);
      setDefaultDateForDaily(); setDefaultWeek(); setDefaultMonth();
      console.log("DOMContentLoaded complete.");
    });
  </script>
</body>
</html>
